<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/layouts/base.xhtml">

<ui:define name="content">

    <p:panel id="rootPanel" header="Подача заявления">
        <p:messages>
            <p:autoUpdate/>
        </p:messages>
        <h:form id="login-form" styleClass="form-blc form-sign-blc" prependId="false">
            <p:panel>
                <h:outputScript library="js" name="rutoken.js"/>
                <h:outputScript library="js" name="PluginManager.js"/>
                <h:outputScript library="js" name="digital_signature.js"/>
                <h:outputScript>
                    $("#login-form").bind("keypress", function (e) {
                        if (e.keyCode == 13) {
                            return false;
                        }
                    });

                </h:outputScript>

                <p:ajaxStatus onstart="PF('statusDialogMain').show()" onsuccess="PF('statusDialogMain').hide()"/>
                <p:dialog id="loadingBar" modal="true" widgetVar="statusDialogMain" header="#{msgs.loading}"
                          draggable="false" closable="false" resizable="false">
                    <p:graphicImage library="images" name="ajax_loader.gif"/>
                </p:dialog>

                <div class="login-box">
                    <div id="divFailure" class="failure" style="display: none; color:red;"></div>
                    <input type="button" id="btnDetectDevices"
                           style="display: none; background: rgba(24, 146, 24, 0.92);width: 280px;"
                           value="Поиск устройств"/>
                    <br/>
                    <select id="sltTokenList" style="display: none; width: 280px;"></select>
                    <br/>
                    <input type="password" id="pwdPinCode" style="display: none; width: 280px;"
                           placeholder="Введите PIN-код" maxlength="8"/>
                    <br/>
                    <input value="#{registrationBean.random}" id="data" style="display: none; width: 280px;"/>
                    <h:inputText id="signed_data" value="#{registrationBean.signedData}"
                                 style="display: none; width: 280px;"/>
                    <input type="button" id="btnEnter" style="display: none; width: 280px;"
                           value="#{msgs.readInfo}"/>
                    <h:commandButton id="saveButton" value="#{msgs.readInfo}" update="sign-blc-form"
                                     action="#{registrationBean.readInfo()}"
                                     style="display:none;"/>

                </div>
            </p:panel>
        </h:form>

        <h:form id="form1">
        	<p:panel id="panel1" header="РАЗДЕЛ I. ИНФОРМАЦИЯ О НАЛОГОПЛАТЕЛЬЩИКЕ" rendered="#{not empty(registrationBean.entity.companyInn)}">
                <p:panelGrid id="grid1" columns="2">
                    <p:outputLabel value="#{msgs.inn}"/>
                    <p:inputMask mask="99999999999999" value="#{registrationBean.entity.companyInn}" readonly="true"/>

                    <p:outputLabel value="Наименование организации/ИП:"/>
                    <p:inputText value="#{registrationBean.entity.companyName}" readonly="true"/>
                </p:panelGrid>
                <p:panelGrid id="grid2" columns="2">
                    <p:outputLabel value="#{msgs.fio}"/>
                    <p:inputText value="#{registrationBean.entity.signerName}" readonly="true"/>

                    <p:outputLabel value="#{msgs.passportNumber}"/>
                    <p:inputText value="#{registrationBean.entity.signerPassportNumber}" readonly="true"/>

                    <p:outputLabel value="#{msgs.position}"/>
                    <p:inputText value="#{registrationBean.entity.signerPosition}" readonly="true"/>

                    <p:outputLabel value="#{msgs.email}"/>
                    <p:inputText value="#{registrationBean.entity.email}" readonly="false"/>
                    
                    <h:outputText value="#{msgs.regType}" styleClass="form-table-label disp-blc"/>
					<p:autoComplete id="regType" size="27" dropdown="true" converter="dictionaryConverter"   
				    	var="c" itemValue="#{c}" itemLabel="#{c.name}" 
						value="#{registrationBean.entity.regType}" completeMethod="#{registrationBean.findRegType}"
						required="true"	requiredMessage="#{msgs.regType} - #{msgs.thisFieldIsRequired}">
						<p:column><h:outputText value="#{c.name}"/></p:column>
					</p:autoComplete>
					
                    <h:outputText value="#{msgs.regBase}" styleClass="form-table-label disp-blc"/>
					<p:autoComplete id="regBase" size="27" dropdown="true" converter="dictionaryConverter"   
				    	var="c" itemValue="#{c}" itemLabel="#{c.name}" 
						value="#{registrationBean.entity.regBase}" completeMethod="#{registrationBean.findRegBase}"
						required="true"	requiredMessage="#{msgs.regBase} - #{msgs.thisFieldIsRequired}">
						<p:column><h:outputText value="#{c.name}"/></p:column>
					</p:autoComplete>
					
                </p:panelGrid>

                <p:panelGrid id="grid3" columns="2">
                    <p:outputLabel value="Филиал"/>
                    <p:selectBooleanCheckbox id="filial" value="#{registrationBean.entity.filial}">
                        <p:ajax update="grid3"/>
                    </p:selectBooleanCheckbox>

                    <p:outputLabel value="ИНН главного" rendered="#{registrationBean.entity.filial}"/>
                	<p:autoComplete id="parentInn" size="27" dropdown="true" converter="legalPersonConverter"  rendered="#{registrationBean.entity.filial}" 
				    	var="c" itemValue="#{c}" itemLabel="#{c.fullName ne null ? (c.inn.concat(' - ').concat(c.fullName)) : ''}" 
						value="#{registrationBean.parent}" completeMethod="#{registrationBean.findParentLegalPerson}" 
						minQueryLength="3" required="true"	requiredMessage="ИНН главного - #{msgs.thisFieldIsRequired}">
						<p:column><h:outputText value="#{c.inn}"/></p:column>
			            <p:column><h:outputText value="#{c.fullName}"/></p:column>
					</p:autoComplete>
                    
                </p:panelGrid>
                
                <p:panel>
                    <p:commandButton id="signAndSend" value="Отправить" action="#{registrationBean.onOk()}"/>
                    <p:button id="cancel" value="Отмена" outcome="login"/>
                </p:panel>
            </p:panel>

        </h:form>

    </p:panel>

   </ui:define>
</ui:composition>